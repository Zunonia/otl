{% extends 'layout.html' %}
{% block headers %}
<link rel="stylesheet" type="text/css" href="/media/favorites.css" ></link>
<script type="text/javascript" src="/media/js/prototype/prototype-1.6.0.3.js" ></script>
<script type="text/javascript" >
LinkThumb=
{
	initialize:function(wrap,className)
	   {
		   	this.wrap=$(wrap);
			this.anchors = $A(document.getElementsByClassName(className));
			this.isOver=false;
			this.onLoad();
	   },
	onLoad:function()
	   {
		   	this.thumb = document.createElement('div');
			this.thumb.addClassName('linkthumb');

			this.img = document.createElement('img');
			this.thumb.appendChild(this.img);

			this.thumb.hide();
			document.body.appendChild(this.thumb);

			this.registerHandlers();
	   },
	registerHandlers:function()
		 {
			Event.observe(document,'mousemove',this.onMove.bindAsEventListener(this));
			this.anchors.each(function(item)
					{
						Event.observe(item,'mouseover',this.onOver.bindAsEventListener(this,item));
						Event.observe(item,'mouseout',this.onOut.bindAsEventListener(this));
					}.bind(this));
		 },
	onMove:function(e)
		{
			if(this.isOver)
			{
				var x=e.pointerX()+20,y=e.pointerY()+20;
				this.thumb.style.left=x+'px';
				this.thumb.style.top=y+'px';
			}
		},
	onOver:function(e,item)
		{
			this.img.src= 'http://open.thumbshots.org/image.aspx?url='+item.href;
			this.thumb.show();
			this.isOver=true;
			this.onMove(e);
		},
	onOut:function(e)
	  {
			this.thumb.hide();
			this.img.src = '#';
			this.isOver=false;
	  }
};

		
	Event.observe(window,'load',function()
			{
		LinkThumb.initialize('publicFavorites','favorite-link');
	});
</script>
<style type="text/css">
	.linkthumb
	{
		z-index:1000;
		left:0;
		top:0;
		position:absolute;
		display:block;
		background:black;
		padding:5px;
		height:90px;
		width:120px;
	}
</style>

{% endblock %}
{% block content %}
<h2>과목 즐겨찾기 ({{current_year}}년 {{current_semester}}학기)</h2>
<div id="myFavorites">
	<h3>내 즐겨찾기</h3>
{% if user.is_authenticated %}
	<ul>
	{% for item in favorite_list %}
		<li>
			<a class="favorite-link" href="{{item.url}}" target="_blank" >	
				<h4>{{item.course_code}}: {{item.course_name}} (등록수 : {{item.favored_count}})</h4>
				{{item.url}}
			</a>
			<a class="control-delete" href="/favorites/delete/{{item.id}}">Delete</a>:
		</li>
	{% endfor %}
	</ul>
{% else %}
	<p>로그인하지 않았습니다. :)</p>
{% endif %}
</div>
<div id="publicFavorites">
	<h3>다른 사람들의 즐겨찾기</h3>
	<a href="/favorites/morelist">더보기</a>
	<form id="create-form" method="get" action="/favorites/create/">
		<div id="add-public-favorite">
			즐겨찾기 등록 : code <input type="text" id="code" name="code" value="" size="5"/>
			name <input type="text" id="name" name="name" value="" size="5"/>	
			url <input type="text" id="url" name="url" value="" size="5"/>
			<input id="create-form" type="submit" value="등록" />
		</div>
	</form>
	<ul>
	{% for item in recently_added_list %}
		<li>
		<a class="favorite-link" href="{{item.url}}" target="_blank" >
				<h4>{{item.course_code}}: {{item.course_name}} (등록수 : {{item.favored_count}})</h4>
				{{item.url}}
			</a>
			<span class="submitter">올린이 : <a href="/accounts/view/{{item.writer.username}}">{{item.writer.username}}</a></span>	
			<a class="control-add" href="/favorites/add/{{item.id}}">Add</a>
		</li>
	{% endfor %}
	</ul>
	<div class="pages">
		{% if current_page.has_previous %}
		<a class="prev-page" href="?page={{current_page.previous_page_number}}">Prev</a>
		{% endif %}
		{% for page in current_page.paginator.page_range %}
		<a class="page{% ifequal page.number current_page.number %} selected{% endifequal %}" href="?page={{page.number}}">{{page.number}}</a>
		{% endfor %}
		{% if current_page.has_next %}
		<a class="next-page" href="?page={{current_page.next_page_number}}">Next</a>
		{% endif %}
	</div>
	<form id="search-form" method="get" action="/favorites/search/">
		<p><label for="search-query">검색 : </label><input type="text" id="search-query" name="query" /><input type="submit" value="Find" /></p>
		<ul>
			{% if search_list %}
				{% for item in search_list %}
				<li>
					<a class="search-link" href="{{item.url}}" target="_blank">
						<h4>{{item.year}} {{item.semester}} {{item.course_code}}: {{item.course_name}} ( 등록수 : {{item.favored_count}} )</h4>
						{{item.url}}
					</a>
					<span class="submitter">올린이 : <a href="/accounts/view/{{item.writer.username}}">{{item.writer.username}}</a></span>
					<a class="control-add" href="/favorites/add/{{item.id}}">Add</a>
				</li>
				{% endfor%}
			{% else %}
				<p>검색 결과가 없습니다.</p>
			{% endif %}
		</ul>
		<div class="search-pages">
			{% if search_page.has_previous %}
			<a class="search-prev-page" href="?query={{search_code}}&search-page={{search_page.previous_page_number}}">Prev</a>
			{% endif %}
			{% for page in search_page.paginator.page_range %}
			<a class="search-page{% ifequal page.number search_page.number %} selected{% endifequal %}" href="?query={{search_code}}&search-page={{page.number}}">{{page.number}}</a>
			{% endfor %}
			{% if search_page.has_next %}
			<a class="search-next-page" href="?query={{search_code}}&search-page={{search_page.next_page_number}}">Next</a>
			{% endif %}
		</div>
	</form>
</div>
{% endblock %}
